# language: zh-TW
功能: 支付處理
  作為一個支付系統
  我想要能夠處理支付請求
  以便客戶可以完成訂單付款

  背景:
    假設 支付系統已經啟動並運行
    而且 消息隊列已配置
    而且 信用卡驗證服務可用

  場景: 成功處理支付請求
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-001"
    而且 支付金額為 100.00 元
    而且 信用卡號為 "4111111111111111"
    而且 信用卡有效期為 "12/25"
    而且 CVV為 "123"
    當 處理支付請求
    那麼 支付應該成功
    而且 支付狀態應該是 "SUCCESS"
    而且 應該發送支付確認消息

  場景: 信用卡號無效的支付請求
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-002"
    而且 支付金額為 100.00 元
    而且 信用卡號為 "1234567890123456"
    而且 信用卡有效期為 "12/25"
    而且 CVV為 "123"
    當 處理支付請求
    那麼 支付應該失敗
    而且 支付狀態應該是 "FAILED"
    而且 失敗原因應該包含 "信用卡號無效"

  場景: 信用卡已過期的支付請求
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-003"
    而且 支付金額為 100.00 元
    而且 信用卡號為 "4111111111111111"
    而且 信用卡有效期為 "01/20"
    而且 CVV為 "123"
    當 處理支付請求
    那麼 支付應該失敗
    而且 支付狀態應該是 "FAILED"
    而且 失敗原因應該包含 "信用卡已過期"

  場景: CVV無效的支付請求
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-004"
    而且 支付金額為 100.00 元
    而且 信用卡號為 "4111111111111111"
    而且 信用卡有效期為 "12/25"
    而且 CVV為 "12"
    當 處理支付請求
    那麼 支付應該失敗
    而且 支付狀態應該是 "FAILED"
    而且 失敗原因應該包含 "CVV格式無效"

  場景: 支付金額為零的請求
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-005"
    而且 支付金額為 0.00 元
    而且 信用卡號為 "4111111111111111"
    而且 信用卡有效期為 "12/25"
    而且 CVV為 "123"
    當 處理支付請求
    那麼 支付應該失敗
    而且 支付狀態應該是 "FAILED"
    而且 失敗原因應該包含 "支付金額必須大於零"

  場景: 支付重試機制
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-006"
    而且 支付金額為 100.00 元
    而且 信用卡號為 "4111111111111111"
    而且 信用卡有效期為 "12/25"
    而且 CVV為 "123"
    而且 支付服務暫時不可用
    當 處理支付請求
    那麼 系統應該進行重試
    而且 重試次數不應超過 3 次
    而且 重試間隔應該遞增

  場景大綱: 不同金額的支付處理
    假設 收到支付請求消息
    而且 訂單ID為 "ORDER-<序號>"
    而且 支付金額為 <金額> 元
    而且 信用卡號為 "4111111111111111"
    而且 信用卡有效期為 "12/25"
    而且 CVV為 "123"
    當 處理支付請求
    那麼 支付應該成功
    而且 支付金額應該是 <金額> 元

    例子:
      | 序號 | 金額    |
      | 007  | 25.99   |
      | 008  | 500.00  |
      | 009  | 1299.95 |